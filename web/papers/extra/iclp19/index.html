<html>
  <head>
    <meta charset="utf-8"/>
    <title>Control-Flow Refinement by Partial Evaluation - Jesús J. Doménech, John P. Gallagher and Samir Genaim</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="js/tablefilter/style/tablefilter.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script type="text/javascript" src="js/tablefilter/tablefilter.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-140601506-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-140601506-1');
</script>

  </head>
  <body>
      <div id="top">
	<h1> Control-Flow Refinement by Partial Evaluation, and its Application to Termination and Cost Analysis</h1><em style="margin-bottom:10px"> Jesús J. Doménech, John P. Gallagher and Samir Genaim</em>
      </div>
    <div id="content">

      <div id="right">
	<div id="description" include-html="description.html"></div>
	<div id="tools" include-html="tools.html"></div>
	<div id="examples" include-html="examples.html"></div>
	<div id="experiments" include-html="experiments.html"></div>
      </div>
      <div id="left" include-html="menu.html">
      </div>
    </div>
    <script>
     function resize_table(table){
       var $table = $(table);
       var $bodyCells = $table.find('tbody tr:visible').eq(0).children(),
	   colWidth;
       // Get the tbody columns width array
       colWidth = $bodyCells.map(function() {
	 return $(this).width();
       }).get();
       console.log(colWidth);
       
       // Set the width of thead columns
       $table.find('thead tr').children().each(function(i, v) {
	 $(v).width(colWidth[i]+2);
       });
     }
 // Adjust the width of thead cells when window resizes
 $(window).resize(function() {
     $("table.fixed_header").each(function(){
       resize_table(this);
     });
 }).resize(); // Trigger resize handler


     function includeHTML(container) {
       var seconds = Math.round(new Date() / 1000);
       $("[include-html]",container).each(function(){
	 var base = $(this);
         var file = $(base).attr("include-html");
         if (file) {
	   var file2 = file + "?" + seconds;
	   $(base).load(file2, function() {
	     $(base).removeAttr("include-html");
             includeHTML($(base));
	   });
         }

       });
     }
     var opts_txts = ['Yes', 'Maybe', 'Timeout', 'Error'];
     var opts_vals = ['Y*', 'M*', 'T*', 'U*'];
     var filtersConfig = {
       base_path: 'js/tablefilter/',
       col_1: 'select', col_2: 'select', col_3: 'select', col_4: 'select',
       col_5: 'select', col_6: 'select', col_7: 'select', col_8: 'select', col_9: 'select',
       col_10: 'select', col_11: 'select', col_12: 'select', col_13: 'select', col_14: 'select',
       col_15: 'select', col_16: 'select', col_17: 'select', col_18: 'select', col_19: 'select',
       col_20: 'select', col_21: 'select', col_22: 'select', 

       rows_counter: {
	 text: 'Examples: '
       } ,
       btn_reset: true,
       loader: true,
       status_bar: true,
       mark_active_columns: true,
       highlight_keywords: true,
       on_after_filter: function(o){ /*resize_table($("#"+o["id"]));*/ },
       col_types: [
         'string', 'string', 'string', 'string', 'string', 'string',
	 'string', 'string', 'string', 'string', 'string', 'string',
         'string', 'string', 'string', 'string', 'string', 'string',
	 'string', 'string', 'string', 'string', 'string', 'string'
       ],
        /*col_widths: [
          '125px', '45px','45px','45px','45px','45px','45px','45px','45px','45px','45px',
	  '45px','45px','45px','45px','45px','45px','45px','45px','45px','45px','45px','45px'
        ],*/
      headers_row_index: 2,

       custom_options: {
         cols:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],
         texts: [opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,
		 opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,
		 opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,
		 opts_txts,opts_txts,opts_txts,opts_txts,opts_txts,opts_txts],
         values: [opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,
		  opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,
		  opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,opts_vals,
		  opts_vals,opts_vals, opts_vals,opts_vals,opts_vals,opts_vals],
         sorts: [false]
       },

       extensions:[{ name: 'sort' },
		   { name: 'colOps',
		     col: [ 1,
			    2, 2, 3, 3, 4, 4,
			    5, 5, 6, 6, 7, 7,
			    8, 8, 9, 9, 10, 10,
			    11, 11, 12, 12, 13, 13,
			    14, 14, 15, 15, 16, 16,
			    17, 17, 18, 18, 19, 19,
			    20, 20, 21, 21, 22, 22
		     ],
		     id: [ "sum00",
			   "sum11", "pcfr11", "sum12", "pcfr12", "sum13", "pcfr13",
			   "sum14", "pcfr14", "sum15", "pcfr15", "sum16", "pcfr16",
			   "sum17", "pcfr17", "sum21", "pcfr21", "sum22", "pcfr22",
			   "sum23", "pcfr23", "sum24", "pcfr24", "sum25", "pcfr25",
			   "sum26", "pcfr26", "sum27", "pcfr27", "sum31", "pcfr31",
			   "sum32", "pcfr32", "sum33", "pcfr33", "sum34", "pcfr34",
			   "sum35", "pcfr35", "sum36", "pcfr36", "sum37", "pcfr37"
		     ],
		     decimal_precision: [ 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2,
					  2, 2, 2, 2, 2, 2
		     ]
		   }

       ]
     };
     includeHTML($("#content"));
     function init_table(name){
       var tf = new TableFilter(name, filtersConfig, 2);
       tf.emitter.on(['column-calc'], calcAll);
       tf.init();
       //resize_table("#"+name);
     }

    /**
     * Perform all calculations
     * @param  {Object} tf       TableFilter instance
     * @param  {Object} colOps   ColOps extension instance
     * @param  {Number} colIndex Column index
     */
     function calcAll(tf, colOps, colIndex) {
       if (colIndex == 0) return;
       if (colIndex == 1)
         calc(tf, colOps, colIndex, 'sumT', true, 'sum1');
       else{
         calc(tf, colOps, colIndex, 'sumT', false, 'sum'+colIndex);
         calc(tf, colOps, colIndex, 'perc', true, 'pcfr'+colIndex);
       }
    }

    /**
     * Perform a specified calculation on a column and display result
     * @param  {Object}  tf          TableFilter instance
     * @param  {Object}  colOps      ColOps extension instance
     * @param  {Number}  colIndex    Column index
     * @param  {String}  operation   Calculation to be performed ('sum', 'mean', 'median'...)
     * @param  {Boolean} onlyVisible Perform calculation on only visible data as opposed to filtered data
     * @param  {String}  labelId     Id of DOM element displaying calculation result
     */
    function calc(tf, colOps, colIndex, operation, onlyVisible, labelId) {

        /** getFilteredDataCol accepts in order of appearance:
            - a column index
            - an optional boolean indicating whether the returned dataset also includes the colunm header
            - an optional boolean indicating whether the returned dataset should return numbers (string by default)
            - an optional array of row indexes to be excluded from the returned dataset
            - an optional boolean indicating whether the returned dataset should only include filtered and
            visible data (true by default) or filtered only (paging can contain filtered data which is not visible)
            Refer to: http://koalyptus.github.io/TableFilter/docs/class/src/tablefilter.js~TableFilter.html#instance-method-getFilteredDataCol
        */
      var colValues = tf.getFilteredDataCol(colIndex, false, true, [], onlyVisible);
        var result = 0;

        // Refer to ColOps API to perform desired calculations
        // http://koalyptus.github.io/TableFilter/docs/class/src/extensions/colOps/colOps.js~ColOps.html
        if(operation === 'sumT') {
          result = calcSum(colValues)/60;
	  result.toFixed(2);
        }
        else if(operation === 'perc') {
          result = calcPerc(colValues);
	  result.toFixed(2);
	  result = "" + result + "%"
        }
        // display result
      $("#"+tf["id"]+" #"+labelId).text(result);
    }
     /**
     * Calculate the sum of passed values.
     * @param {Array} [values=[]] List of values
     * @returns {Number}
     */
     function calcSum(values = [], idx = 0) {
        if (values.length == 0) {
            return parseFloat(0);
        }
       var regex = /[+-]?\d+(\.\d+)?/g;
       var nums = values.map((x) => x.match(regex).map(function(v) { return parseFloat(v);}));
       if (idx == 1) console.log(nums);
       return nums.reduce((x,y) => Number(x) + Number(y[idx]));
     }
     function calcPerc(values = []) {
       if (values.length == 0) {
         return 0;
       }
       var tot = calcSum(values);
       if (tot == 0)
	 return 0;
       var cfr = calcSum(values, 1);
       console.log(tot, cfr);
       return 100*cfr / tot;
    }
    </script>
  </body>
</html>
